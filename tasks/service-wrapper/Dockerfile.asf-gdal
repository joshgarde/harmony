ARG BASE_IMAGE=asfdataservices/gdal-subsetter
FROM ${BASE_IMAGE}

RUN useradd node
RUN apt-get install -y npm
RUN npm install -g npm@7

RUN mkdir -p /service-wrapper
RUN mkdir -p /tmp/metadata
COPY package.json package-lock.json /service-wrapper/
WORKDIR /service-wrapper
RUN npm ci
COPY . /service-wrapper/
RUN chown -R node /service-wrapper
USER node

ENTRYPOINT [ "npm", "run", "start" ]