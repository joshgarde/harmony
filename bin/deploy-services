#!/bin/bash
# create back end services for Harmony

source "env-defaults"
source ".env"

export HOST_VOLUME_PATH=$HOST_VOLUME_PATH

if [[ -z "${HOST_VOLUME_PATH}" ]]; then
  echo "HOST_VOLUME_PATH must be set before running this script"
  exit 1
fi

. ./bin/create-k8s-config-maps-and-secrets

for file in tasks/service-wrapper/config/*.yaml
do
  echo "Deploying $file using volume mount path $HOST_VOLUME_PATH"
  envsubst < $file | kubectl apply -f - -n argo
done
